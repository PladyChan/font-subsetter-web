# 阿里内部平台部署指南

通过阿里内部部署平台（类似 Aone/DevOps）实现类似 Vercel 的自动部署效果。

## 部署步骤

### 1. 在部署平台配置构建和部署

根据界面显示，你的项目已经有一个进行中的发布（release-1.0.0）。要实现自动部署：

#### 方式一：使用构建脚本（推荐）

1. **进入"设置"页面**
   - 在项目概览页面，点击左侧"设置"

2. **配置构建步骤**
   - 找到"构建配置"或"CI/CD 配置"
   - 添加构建步骤：
     ```bash
     chmod +x build.sh
     ./build.sh
     ```

3. **配置部署步骤**
   - 添加部署步骤：
     ```bash
     chmod +x deploy.sh
     ./deploy.sh
     ```

#### 方式二：使用 Docker（如果平台支持）

1. **在"设置"中配置 Docker 构建**
   - 平台会自动使用项目根目录的 `Dockerfile`
   - 构建完成后自动部署

2. **配置环境变量**（如果需要）：
   - `PORT`: 服务端口（通常平台会自动设置）
   - `FLASK_ENV`: `production`

#### 方式三：使用 GitLab CI/CD

如果平台支持 GitLab CI/CD，项目已包含 `.gitlab-ci.yml` 配置文件：

1. **平台会自动识别** `.gitlab-ci.yml`
2. **每次推送到 master 或 release 分支**会自动触发构建
3. **部署需要手动触发**（在 CI/CD 页面点击"部署"）

### 2. 完成发布流程

1. **等待当前发布完成**
   - 当前有一个进行中的发布：`release-1.0.0`
   - 在"主干发布"页面查看发布状态

2. **发布完成后**
   - 平台会自动生成访问 URL
   - 通常格式类似：`https://trimtype-xxx.alibaba-inc.com`

### 3. 实现自动部署（类似 Vercel）

要实现类似 Vercel 的自动部署效果：

#### 选项 A：配置自动发布

1. 在"设置" → "发布配置"中
2. 启用"自动发布"选项
3. 设置触发条件：
   - 当代码推送到 `master` 分支时自动发布
   - 或当主干测试通过时自动发布

#### 选项 B：使用 Webhook

1. 在 GitLab 仓库设置中配置 Webhook
2. 当代码推送时，自动触发平台构建和部署

## 配置文件说明

项目已包含以下配置文件：

### `build.sh` - 构建脚本
- 安装 Python 依赖
- 准备运行环境

### `deploy.sh` - 部署脚本
- 使用 Gunicorn 启动 Flask 应用
- 配置生产环境参数

### `Dockerfile` - Docker 配置
- 容器化部署配置
- 适合支持 Docker 的平台

### `.gitlab-ci.yml` - CI/CD 配置
- GitLab CI/CD 自动构建和部署
- 支持手动触发部署

## 验证部署

部署完成后，检查：

1. **服务状态**
   - 在平台查看服务运行状态
   - 检查日志是否有错误

2. **访问网站**
   - 使用平台提供的访问 URL
   - 测试文件上传和处理功能

3. **监控**
   - 查看应用日志
   - 检查性能指标

## 常见问题

### Q: 如何查看部署日志？
A: 在平台的"发布记录"或"日志"页面查看

### Q: 如何回滚到上一个版本？
A: 在"发布记录"页面找到之前的版本，点击"回滚"

### Q: 如何配置自定义域名？
A: 在"设置" → "域名配置"中添加自定义域名

### Q: 如何设置环境变量？
A: 在"设置" → "环境变量"中添加，例如：
- `FLASK_ENV=production`
- `PORT=8080`

## 下一步

1. ✅ 代码已推送到 GitLab
2. ⏳ 等待当前发布（release-1.0.0）完成
3. ⏳ 配置自动部署（可选）
4. ⏳ 获取访问 URL
5. ⏳ 测试网站功能

## 提示

- 如果平台界面有"一键部署"按钮，可以直接使用
- 查看平台的帮助文档了解具体配置方法
- 联系平台管理员获取技术支持

