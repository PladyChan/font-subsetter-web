<!DOCTYPE html>
<html>
<head>
    <title>TrimTypeå­—ä½“è£å‰ªå·¥å…·</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <link rel="icon" type="image/svg+xml" href="static/favicon.svg">
    <link rel="icon" type="image/png" href="static/favicon.png">
    <link rel="shortcut icon" href="static/favicon.ico">
    <!-- Google Fonts: Climate Crisis - æ ‡é¢˜å­—ä½“ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Climate+Crisis&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #000000;
            --card-bg: #111111;
            --nav-bg: rgba(255, 255, 255, 0.04);
            --primary: #3043eb;
            --primary-hover: #4c5df6;
            --text: #FFFFFF;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --border: rgba(255, 255, 255, 0.1);
            --success: #4CAF50;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
            background-color: var(--bg-color);
            color: var(--text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            position: relative;
            overflow-x: hidden;
        }
        
        /* å…¨å±€çƒŸèŠ±æ•ˆæœå®¹å™¨ - æ”¾åœ¨ body èƒŒæ™¯å±‚ */
        .fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 0; /* åœ¨æœ€åº•å±‚ï¼Œä½œä¸ºèƒŒæ™¯ */
            overflow: hidden;
        }
        
        /* å…è®¸è¾“å…¥æ¡†å’Œæ–‡æœ¬åŒºåŸŸé€‰æ‹©æ–‡æœ¬ */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        .nav {
            position: relative;
            height: 64px;
            background: var(--nav-bg);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 40px;
            z-index: 10;
        }
        
        .nav-brand {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .nav-brand span {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .top-bar {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .language-switcher {
            display: flex;
            gap: 8px;
            background: var(--card-bg);
            border: none;
            border-radius: 16px;
            padding: 4px;
            backdrop-filter: blur(8px);
        }
        
        .lang-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 999px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .lang-btn:hover {
            color: var(--text);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .lang-btn.active {
            background: var(--border);
            color: var(--text);
        }
        
        .hero {
            margin-top: 40px;
            margin-bottom: 0px;
            text-align: center;
            padding: 0 20px;
            width: 100%;
            max-width: 100%;
            position: relative;
            z-index: 1; /* ç¡®ä¿å†…å®¹åœ¨çƒŸèŠ±ä¹‹ä¸Š */
        }
        
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            animation: firework-explode 0.8s ease-out forwards;
            box-shadow: 0 0 20px currentColor;
        }
        
        @keyframes firework-explode {
            0% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 1;
                transform: scale(1.5);
            }
            100% {
                opacity: 0;
                transform: scale(0);
            }
        }
        
        .firework-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-fly 1.5s ease-out forwards;
            box-shadow: 0 0 8px currentColor;
        }
        
        @keyframes particle-fly {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(0);
            }
        }
        
        .hero h1 {
            font-size: clamp(32px, 5vw, 64px);
            font-weight: 600;
            line-height: 1.2;
            margin: 0;
            background-image: none;
            -webkit-background-clip: unset;
            background-clip: unset;
            color: var(--text);
            font-family: "Climate Crisis", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            letter-spacing: 0px;
            height: fit-content;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
            position: relative;
            z-index: 1; /* ç¡®ä¿æ–‡å­—åœ¨çƒŸèŠ±ä¹‹ä¸Š */
        }
        
        .hero h1:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }
        
        .hero p {
            position: relative;
            z-index: 1; /* ç¡®ä¿æ–‡å­—åœ¨çƒŸèŠ±ä¹‹ä¸Š */
        }
        
        /* ç¡®ä¿æ‰€æœ‰å†…å®¹å±‚åœ¨çƒŸèŠ±ä¹‹ä¸Š */
        .nav,
        .container,
        footer {
            position: relative;
            z-index: 1;
        }
        
        /* é¡¶éƒ¨æ ä¿æŒ fixed å®šä½åœ¨å³ä¸Šè§’ */
        .top-bar {
            z-index: 10; /* ç¡®ä¿åœ¨çƒŸèŠ±ä¹‹ä¸Š */
        }
        
        .hero p {
            font-size: clamp(14px, 2vw, 20px);
            color: var(--text-secondary);
            margin: 16px auto 24px;
            max-width: 600px;
            line-height: 1.6;
            width: fit-content;
            display: flex;
            flex-wrap: wrap;
            height: fit-content;
            vertical-align: top;
            letter-spacing: 3.3px;
        }
        
        .download-local-btn {
            display: inline-flex;
            align-items: center;
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 999px;
            color: var(--text);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .download-local-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(94, 106, 210, 0.2);
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            padding: 30px 0;
            padding-left: 0px;
            padding-right: 0px;
            display: grid;
            grid-template-columns: 1fr 1fr; /* è®©ä¸¤ä¸ªå¡ç‰‡ç­‰å®½ */
            column-gap: 0;
            row-gap: 0;
            align-items: start;
            margin: 0;
            margin-left: 0px;
            margin-right: 0px;
            position: relative;
            z-index: 1;
        }
        
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡ºå½±å“é—´è· */
            padding-left: 20px;
            padding-right: 20px;
        }
        
        .upload-area {
            background: var(--card-bg);
            border-radius: 24px;
            padding: clamp(20px, 4vw, 32px);
            text-align: center;
            border: 1px solid var(--border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .upload-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.1) 50%,
                transparent 100%);
        }
        
        .upload-area:hover, .upload-area.dragover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
        }
        
        .file-list {
            margin-top: 20px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 8px;
        }
        
        .file-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .file-list::-webkit-scrollbar-track {
            background: var(--card-bg);
            border-radius: 4px;
        }
        
        .file-list::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }
        
        .file-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .file-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 16px;
            padding: 12px 16px;
            margin: 4px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .file-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin: 24px 0;
        }
        
        .button {
            background: var(--primary);
            color: var(--text);
            border: none;
            padding: 0 32px;
            border-radius: 999px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            height: 48px;
            position: relative;
            overflow: hidden;
        }
        
        #process-btn {
            font-size: 18px;
            height: fit-content;
            padding-top: 20px;
            padding-bottom: 20px;
            margin-top: 0;
            margin-bottom: 0;
        }
        
        .button:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 8px 24px rgba(94, 106, 210, 0.3);
        }
        
        .button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%,
                transparent 100%);
        }
        
        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .options-panel {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 0 24px;
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
            min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡ºå½±å“é—´è· */
            margin-left: 20px;
            margin-right: 20px;
        }
        
        .options-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.1) 50%,
                transparent 100%);
        }
        
        .option-section {
            position: relative;
            padding: 24px 0 12px;
            margin: 0;
            width: 100%;
            height: fit-content;
        }
        
        .option-section:last-child {
            margin-bottom: 0;
        }
        
        .option-section + .option-section {
            border-top: 1px solid var(--border);
        }
        
        .option-section h3 {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            margin: 0 0 20px 0;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        
        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            column-gap: clamp(8px, 2vw, 12px);
            row-gap: clamp(8px, 2vw, 12px);
            width: 100%;
            margin-bottom: 12px;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 16px;
            transition: all 0.2s;
        }
        
        .option-item:hover {
            background: rgba(255, 255, 255, 0.03);
        }
        
        input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 1px solid var(--border);
            border-radius: 6px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
            background: rgba(255, 255, 255, 0.03);
        }
        
        input[type="checkbox"]:checked {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        input[type="checkbox"]:checked::after {
            content: "âœ“";
            color: white;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }
        
        .option-text {
            margin-left: 12px;
            color: var(--text);
            font-size: 14px;
        }
        
        .progress {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 40px 80px;
            border-radius: 20px;
            font-size: 48px;
            font-weight: 600;
            display: none;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 1000; /* ç¡®ä¿è¿›åº¦æ¡åœ¨æœ€ä¸Šå±‚ */
        }
        
        .file-result {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 12px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 24px;
        }
        
        .file-name {
            color: var(--text);
            font-weight: 500;
            font-size: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .file-stats {
            display: flex;
            align-items: center;
            gap: 24px;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stat-label {
            color: var(--text-secondary);
        }
        
        .stat-value {
            color: var(--text);
        }
        
        .reduction {
            color: var(--success);
            font-weight: 500;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .custom-chars-input {
            margin-top: 12px;
            margin-bottom: 12px;
            margin-left: 0;
            margin-right: 0;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            height: fit-content;
            padding-top: 0;
            padding-bottom: 0;
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            text-align: left;
            vertical-align: top;
            background: unset;
            background-color: unset;
        }
        
        .custom-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .custom-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(94, 106, 210, 0.2);
        }
        
        .custom-input::placeholder {
            color: var(--text-secondary);
        }
        
        .option-group {
            background: var(--card-bg);
            border-radius: 24px;
            padding: 24px;
            padding-left: 32px;
            padding-right: 32px;
            border: 1px solid var(--border);
        }
        
        .option-group + .option-group {
            margin-top: 16px;
        }
        
        .option-group h3 {
            font-size: 16px;
            font-weight: 500;
            margin: 0 0 16px 0;
            color: var(--text-secondary);
        }
        
        .custom-chars-input {
            margin-top: 12px;
            margin-bottom: 12px;
            margin-left: 0;
            margin-right: 0;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            height: fit-content;
            padding-top: 0;
            padding-bottom: 0;
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-secondary);
            text-align: left;
            vertical-align: top;
            background: unset;
            background-color: unset;
        }
        
        .custom-input {
            width: 95%;
            padding: 12px;
            padding-left: 16px;
            padding-right: 16px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: var(--card-bg);
            color: var(--text);
            font-size: 16px;
            transition: all 0.2s;
        }
        
        #customChars {
            width: 100%;
            display: block;
            min-height: 48px;
            box-sizing: border-box;
            overflow: hidden;
            resize: none;
            margin: 0;
            padding: 12px;
            padding-left: 12px;
            padding-right: 12px;
            border: 0;
            border-style: none;
            border-width: 0;
            border-color: rgba(0, 0, 0, 0);
            border-image: none;
            background: unset;
            background-color: unset;
            border-radius: 12px;
            line-height: 1.5;
        }
        
        .result-panel {
            margin-top: 20px;
        }
        
        .result-item {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .result-item.error {
            border-color: #ff4444;
        }
        
        .result-item .filename {
            font-weight: 500;
        }
        
        .result-item .status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .result-item .status.success {
            background: rgba(76, 175, 80, 0.1);
            color: #4CAF50;
        }
        
        .result-item .status.error {
            background: rgba(255, 68, 68, 0.1);
            color: #ff4444;
        }
        
        .result-item .error-message {
            color: #ff4444;
            margin-left: 12px;
        }
        
        .result-item .download-btn {
            background: var(--primary);
            color: white;
            text-decoration: none;
            padding: 6px 16px;
            border-radius: 999px;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .result-item .download-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }
        
        .option-group {
        }
        
        #progressBar {
            display: none;
        }
        
        #progressText {
            display: none;
        }
        
        #downloadArea {
            margin: 20px 0;
            text-align: center;
        }
        
        /* å“åº”å¼å¸ƒå±€ - å¹³æ¿å’Œä¸­ç­‰å±å¹• */
        @media (max-width: 1000px) {
            .container {
                grid-template-columns: 1fr;
                max-width: 800px;
                gap: 20px; /* ç¡®ä¿çª„å±å¹•æ—¶ä¹Ÿæœ‰é—´è· */
            }
            
            .hero {
                margin-top: 40px;
            }
            
            .left-panel {
                order: 1; /* ä¸Šä¼ å¡ç‰‡åœ¨ä¸Šæ–¹ */
            }
            
            .options-panel {
                order: 2; /* å‚æ•°å¡ç‰‡åœ¨ä¸‹æ–¹ */
            }
        }
        
        /* å“åº”å¼å¸ƒå±€ - ç§»åŠ¨ç«¯ */
        @media (max-width: 768px) {
            body {
                padding: 0;
            }
            
            .top-bar {
                top: 12px;
                right: 12px;
                gap: 8px;
            }
            
            .language-switcher {
                padding: 3px;
                gap: 4px;
            }
            
            .lang-btn {
                padding: 5px 10px;
                font-size: 12px;
            }
            
            .download-local-btn {
                font-size: 12px;
                padding: 6px 16px;
            }
            
            .hero {
                margin-top: 40px;
                padding: 0 16px;
            }
            
            .hero h1 {
                font-size: 32px;
            }
            
            .hero p {
                font-size: 14px;
                margin: 12px auto 20px;
            }
            
            .container {
                padding: 16px 0;
                padding-left: 0px;
                padding-right: 0px;
                gap: 16px; /* ç¡®ä¿ç§»åŠ¨ç«¯ä¹Ÿæœ‰é—´è· */
            }
            
            .left-panel {
                order: 1; /* ä¸Šä¼ å¡ç‰‡åœ¨ä¸Šæ–¹ */
            }
            
            .options-panel {
                order: 2; /* å‚æ•°å¡ç‰‡åœ¨ä¸‹æ–¹ */
            }
            
            .upload-area {
                padding: 24px 16px;
            }
            
            .upload-area p {
                font-size: 14px;
                margin-bottom: 4px;
            }
            
            .file-list {
                max-height: 200px;
            }
            
            .button-group {
                margin: 16px 0;
                gap: 12px;
            }
            
            .option-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .option-section {
                padding: 16px 0 8px;
            }
            
            .option-section h3 {
                font-size: 12px;
                margin: 0 0 12px 0;
            }
            
            .options-panel {
                padding: 0 16px;
            }
            
            .button {
                padding: 0 24px;
                height: 44px;
                font-size: 14px;
            }
            
            .file-result {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }
            
            .file-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
                width: 100%;
            }
            
            .file-stats {
                flex-wrap: wrap;
                gap: 12px;
                width: 100%;
            }
            
            .file-name {
                max-width: 100%;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            .result-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .result-item .error-message {
                margin-left: 0;
                word-break: break-word;
            }
        }
        
        /* å“åº”å¼å¸ƒå±€ - è¶…å°å±å¹• */
        @media (max-width: 480px) {
            .hero {
                margin-top: 40px;
            }
            
            .hero h1 {
                font-size: 28px;
            }
            
            .container {
                padding: 12px 0;
                padding-left: 0px;
                padding-right: 0px;
                gap: 12px; /* ç¡®ä¿è¶…å°å±å¹•ä¹Ÿæœ‰é—´è· */
            }
            
            .left-panel {
                order: 1; /* ä¸Šä¼ å¡ç‰‡åœ¨ä¸Šæ–¹ */
            }
            
            .options-panel {
                order: 2; /* å‚æ•°å¡ç‰‡åœ¨ä¸‹æ–¹ */
            }
            
            .upload-area {
                padding: 20px 12px;
            }
            
            .options-panel {
                padding: 0 12px;
            }
            
            .option-item {
                padding: 8px;
            }
            
            .option-text {
                font-size: 13px;
            }
        }
        
        /* å¤§å±å¹•ä¼˜åŒ– - æå‡å±æ•ˆ */
        @media (min-width: 1600px) {
            .container {
                max-width: 1400px;
                grid-template-columns: 1fr 1fr; /* ä¿æŒç­‰å®½ */
                gap: clamp(20px, 3vw, 0);
            }
            
            .option-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* æ¨ªå±ä¼˜åŒ– */
        @media (max-width: 1000px) and (orientation: landscape) {
            .hero {
                margin-top: 40px;
            }
            
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }
        
        /* æ¨ªå±ä¸”å®½åº¦è¶³å¤Ÿæ—¶ä¿æŒä¸¤åˆ— */
        @media (min-width: 1001px) and (max-width: 1024px) and (orientation: landscape) {
            .hero {
                margin-top: 40px;
            }
            
            .container {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }
        }
        
        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .button {
                min-height: 48px;
                padding: 0 32px;
            }
            
            .option-item {
                min-height: 44px;
            }
            
            .file-item {
                min-height: 44px;
            }
        }
        
        /* é«˜åˆ†è¾¨ç‡å±å¹•ä¼˜åŒ– */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .upload-area::before {
                height: 0.5px;
            }
            
            .options-panel::before {
                height: 0.5px;
            }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        {% if not is_local %}
        <a href="/download/local" class="download-local-btn" data-i18n="download-local">ä¸‹è½½æœ¬åœ°ç‰ˆ</a>
        {% endif %}
        <div class="language-switcher">
            <button class="lang-btn active" data-lang="zh">ä¸­</button>
            <button class="lang-btn" data-lang="en">EN</button>
        </div>
    </div>
    
    <div class="hero">
        <h1>TrimType</h1>
        <p data-i18n="hero-subtitle">æ™ºèƒ½è£å‰ªå­—ä½“æ–‡ä»¶ Â· ä»æœªæœ‰è¿‡çš„ç•…å¿«ä½“éªŒ</p>
    </div>
    
    <div class="container">
        <div class="left-panel">
            <div class="upload-area" id="drop-area">
                <input type="file" id="file-input" accept=".ttf,.otf,.woff,.woff2,.eot,.ttc" multiple style="display: none;">
                <p style="font-size: clamp(14px, 2.5vw, 18px); margin-bottom: 8px;" data-i18n="upload-drag">æ‹–æ”¾å­—ä½“æ–‡ä»¶æˆ–ç‚¹å‡»è¿™é‡Œ</p>
                <p style="color: var(--text-secondary); font-size: clamp(12px, 2vw, 14px);" data-i18n="upload-desc">æ”¯æŒä¸­è‹±æ–‡å­—ä½“ï¼Œå¤„ç†åè‡ªåŠ¨ä¸‹è½½</p>
                <div class="file-list" id="file-list"></div>
            </div>
            
            <div class="button-group">
                <button class="button" id="process-btn" disabled data-i18n="btn-process">å¼€å§‹å¤„ç†</button>
            </div>
            
            <div class="result-panel"></div>
            
            <div id="result" style="display: none;">
                <div id="size-info"></div>
            </div>
        </div>
        
        <div class="options-panel">
            <div class="option-section">
                <h3 data-i18n="section-text">æ–‡å­—ä¸æ ‡ç‚¹</h3>
                <div class="option-grid">
                    <label class="option-item">
                        <input type="checkbox" name="latin" checked>
                        <span class="option-text" data-i18n="opt-latin">è‹±æ–‡å­—æ¯ (a-z, A-Z)</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox" name="chinese_all">
                        <span class="option-text" data-i18n="opt-chinese">ä¸­æ–‡å­—ç¬¦ï¼ˆå…¨éƒ¨ï¼‰</span>
                    </label>
                </div>
                <div class="option-grid">
                    <label class="option-item">
                        <input type="checkbox" name="en_punctuation" checked>
                        <span class="option-text" data-i18n="opt-en-punct">è‹±æ–‡æ ‡ç‚¹ (,.!?@#$%ç­‰)</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox" name="cn_punctuation">
                        <span class="option-text" data-i18n="opt-cn-punct">ä¸­æ–‡æ ‡ç‚¹ï¼ˆï¼Œã€‚ï¼ï¼Ÿâ€¦â€¦ï¼‰</span>
                    </label>
                </div>
                <div class="option-grid">
                    <label class="option-item">
                        <input type="checkbox" name="numbers" checked>
                        <span class="option-text" data-i18n="opt-numbers">æ•°å­— (0-9)</span>
                    </label>
                </div>
            </div>
            
            <div class="option-section">
                <h3 data-i18n="section-symbols">ç¬¦å·</h3>
                <div class="option-grid">
                    <label class="option-item">
                        <input type="checkbox" name="math" checked>
                        <span class="option-text" data-i18n="opt-math">æ•°å­¦ç¬¦å· (+-Ã—Ã·=Â°)</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox" name="currency" checked>
                        <span class="option-text" data-i18n="opt-currency">è´§å¸ç¬¦å· ($â‚¬Â¥Â£)</span>
                    </label>
                </div>
                <div class="option-grid">
                    <label class="option-item">
                        <input type="checkbox" name="arrows">
                        <span class="option-text" data-i18n="opt-arrows">ç®­å¤´ç¬¦å· (â†â†’â†‘â†“)</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox" name="copyright">
                        <span class="option-text" data-i18n="opt-copyright">ç‰ˆæƒç›¸å…³ (Â©Â®â„¢)</span>
                    </label>
                </div>
            </div>
            
            <div class="option-section">
                <h3 data-i18n="section-special">ç‰¹æ®ŠåŠŸèƒ½</h3>
                <div class="option-grid">
                    <label class="option-item">
                        <input type="checkbox" name="ligatures">
                        <span class="option-text" data-i18n="opt-ligatures">è¿å­— (ff, fi, fl)</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox" name="fractions">
                        <span class="option-text" data-i18n="opt-fractions">åˆ†æ•° (Â¼, Â½, Â¾)</span>
                    </label>
                </div>
                <div class="option-grid">
                    <label class="option-item">
                        <input type="checkbox" name="superscript">
                        <span class="option-text" data-i18n="opt-superscript">ä¸Šæ ‡ä¸‹æ ‡ (Â¹Â²Â³, â‚â‚‚â‚ƒ)</span>
                    </label>
                    <label class="option-item">
                        <input type="checkbox" name="diacritics">
                        <span class="option-text" data-i18n="opt-diacritics">å˜éŸ³ç¬¦å· (Ã©, Ã¨, Ãª)</span>
                    </label>
                </div>
            </div>
            
            <div class="option-section">
                <h3 data-i18n="section-custom">è‡ªå®šä¹‰å­—ç¬¦</h3>
                <div class="custom-chars-input">
                    <textarea id="customChars" 
                              rows="1"
                              data-i18n-placeholder="custom-placeholder"
                              placeholder="è¯·è¾“å…¥éœ€è¦ä¿ç•™çš„å­—ç¬¦ï¼Œå¤šä¸ªå­—ç¬¦ä¹‹é—´æ— éœ€åˆ†éš”ï¼Œå¦‚ï¼š&*â€¦ï¿¥" 
                              class="custom-input"></textarea>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="footer-credit" style="text-align: center; margin-top: 40px; margin-bottom: 24px; font-size: 11px; color: rgba(255, 255, 255, 0.45); letter-spacing: 0.06em; text-transform: uppercase;">
        Designed &amp; Developed by <span style="font-weight: 600; color: rgba(255, 255, 255, 0.7);">Plady U^á´¥^U</span>
    </footer>
    
    <div class="progress" id="progress" data-i18n="processing">å¤„ç†ä¸­ </div>
    
    <script>
        // æ˜¯å¦æ˜¯æœ¬åœ°ç¯å¢ƒï¼ˆä»åç«¯ä¼ é€’ï¼‰
        const IS_LOCAL = {% if is_local %}true{% else %}false{% endif %};
        
        // ç¿»è¯‘å¯¹è±¡
        const translations = {
            zh: {
                'hero-subtitle': 'æ™ºèƒ½è£å‰ªå­—ä½“æ–‡ä»¶ Â· ä»æœªæœ‰è¿‡çš„ç•…å¿«ä½“éªŒ',
                'download-local': 'ä¸‹è½½æœ¬åœ°ç‰ˆ',
                'upload-drag': 'æ‹–æ”¾å­—ä½“æ–‡ä»¶æˆ–ç‚¹å‡»è¿™é‡Œ',
                'upload-desc': 'æ”¯æŒä¸­è‹±æ–‡å­—ä½“ï¼Œå¤„ç†åè‡ªåŠ¨ä¸‹è½½',
                'btn-process': 'å¼€å§‹å¤„ç†',
                'section-text': 'æ–‡å­—ä¸æ ‡ç‚¹',
                'opt-latin': 'è‹±æ–‡å­—æ¯ (a-z, A-Z)',
                'opt-chinese': 'ä¸­æ–‡å­—ç¬¦ï¼ˆå…¨éƒ¨ï¼‰',
                'opt-en-punct': 'è‹±æ–‡æ ‡ç‚¹ (,.!?@#$%ç­‰)',
                'opt-cn-punct': 'ä¸­æ–‡æ ‡ç‚¹ï¼ˆï¼Œã€‚ï¼ï¼Ÿâ€¦â€¦ï¼‰',
                'opt-numbers': 'æ•°å­— (0-9)',
                'section-symbols': 'ç¬¦å·',
                'opt-math': 'æ•°å­¦ç¬¦å· (+-Ã—Ã·=Â°)',
                'opt-currency': 'è´§å¸ç¬¦å· ($â‚¬Â¥Â£)',
                'opt-arrows': 'ç®­å¤´ç¬¦å· (â†â†’â†‘â†“)',
                'opt-copyright': 'ç‰ˆæƒç›¸å…³ (Â©Â®â„¢)',
                'section-special': 'ç‰¹æ®ŠåŠŸèƒ½',
                'opt-ligatures': 'è¿å­— (ff, fi, fl)',
                'opt-fractions': 'åˆ†æ•° (Â¼, Â½, Â¾)',
                'opt-superscript': 'ä¸Šæ ‡ä¸‹æ ‡ (Â¹Â²Â³, â‚â‚‚â‚ƒ)',
                'opt-diacritics': 'å˜éŸ³ç¬¦å· (Ã©, Ã¨, Ãª)',
                'section-custom': 'è‡ªå®šä¹‰å­—ç¬¦',
                'custom-placeholder': 'è¯·è¾“å…¥éœ€è¦ä¿ç•™çš„å­—ç¬¦ï¼Œå¤šä¸ªå­—ç¬¦ä¹‹é—´æ— éœ€åˆ†éš”ï¼Œå¦‚ï¼š&*â€¦ï¿¥',
                'processing': 'å¤„ç†ä¸­ ',
                'error': 'é”™è¯¯',
                'process-failed': 'å¤„ç†å¤±è´¥',
                'original': 'åŸå§‹:',
                'optimized': 'ä¼˜åŒ–å:',
                'file-too-large': 'æ–‡ä»¶ {filename} è¶…è¿‡100MBé™åˆ¶',
                'upload-rejected': 'æ–‡ä»¶ä¸Šä¼ è¢«æ‹’ç»ã€‚å¯èƒ½æ˜¯æ–‡ä»¶è¶…è¿‡æœåŠ¡å™¨ä¸Šä¼ é™åˆ¶ï¼ˆçº¦ 4.5-5MBï¼‰ï¼Œè¯·å°è¯•å‹ç¼©æ–‡ä»¶æˆ–ä½¿ç”¨æ›´å°çš„å­—ä½“æ–‡ä»¶ã€‚',
                'too-many-requests': 'è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
                'file-too-big': 'æ–‡ä»¶å¤ªå¤§ï¼Œè¶…è¿‡ 100MB é™åˆ¶',
                'file-too-big-suggestion': 'æ–‡ä»¶è¶…è¿‡ 100MB é™åˆ¶ï¼Œå»ºè®®ä¸‹è½½æœ¬åœ°ç‰ˆè¿›è¡Œå¤„ç†',
                'download-local-suggestion': 'ğŸ’¡ æç¤ºï¼šæ–‡ä»¶è¿‡å¤§æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æœ¬åœ°ç‰ˆè¿›è¡Œå¤„ç†ï¼Œæ— æ–‡ä»¶å¤§å°é™åˆ¶',
                'download-local-link': 'ç‚¹å‡»ä¸‹è½½æœ¬åœ°ç‰ˆ',
                'process-failed-code': 'å¤„ç†å¤±è´¥ï¼ˆé”™è¯¯ä»£ç : {code}ï¼‰',
                'server-error': 'æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œè¯·é‡è¯•',
                'upload-rejected-desc': 'æ–‡ä»¶ä¸Šä¼ è¢«æ‹’ç»ï¼Œå¯èƒ½æ˜¯æ–‡ä»¶è¿‡å¤§æˆ–æœåŠ¡å™¨é™åˆ¶',
                'network-error': 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•',
                'process-error': 'å¤„ç†å¤±è´¥ï¼š{error}',
                'process-error-general': 'å¤„ç†è¿‡ç¨‹ä¸­å‡ºé”™ï¼Œè¯·é‡è¯•'
            },
            en: {
                'hero-subtitle': 'Smart Font Trimming Â· Unprecedented Experience',
                'download-local': 'Download Local Version',
                'upload-drag': 'Drag font files here or click to select',
                'upload-desc': 'Supports Chinese and English fonts, auto-download after processed',
                'btn-process': 'Start Processing',
                'section-text': 'Text & Punctuation',
                'opt-latin': 'Latin Letters (a-z, A-Z)',
                'opt-chinese': 'Chinese Characters (All)',
                'opt-en-punct': 'English Punctuation (,.!?@#$% etc.)',
                'opt-cn-punct': 'Chinese Punctuation (ï¼Œã€‚ï¼ï¼Ÿâ€¦â€¦)',
                'opt-numbers': 'Numbers (0-9)',
                'section-symbols': 'Symbols',
                'opt-math': 'Math Symbols (+-Ã—Ã·=Â°)',
                'opt-currency': 'Currency Symbols ($â‚¬Â¥Â£)',
                'opt-arrows': 'Arrow Symbols (â†â†’â†‘â†“)',
                'opt-copyright': 'Copyright (Â©Â®â„¢)',
                'section-special': 'Special Features',
                'opt-ligatures': 'Ligatures (ff, fi, fl)',
                'opt-fractions': 'Fractions (Â¼, Â½, Â¾)',
                'opt-superscript': 'Superscript/Subscript (Â¹Â²Â³, â‚â‚‚â‚ƒ)',
                'opt-diacritics': 'Diacritics (Ã©, Ã¨, Ãª)',
                'section-custom': 'Custom Characters',
                'custom-placeholder': 'Enter characters to keep, no separators needed, e.g.: &*â€¦ï¿¥',
                'processing': 'Processing ',
                'error': 'Error',
                'process-failed': 'Processing Failed',
                'original': 'Original:',
                'optimized': 'Optimized:',
                'file-too-large': 'File {filename} exceeds 100MB limit',
                'upload-rejected': 'File upload rejected. The file may exceed server upload limit (approx. 4.5-5MB), please try compressing the file or use a smaller font file.',
                'too-many-requests': 'Too many requests, please try again later',
                'file-too-big': 'File too large, exceeds 100MB limit',
                'file-too-big-suggestion': 'File exceeds 100MB limit, suggest downloading local version for processing',
                'download-local-suggestion': 'ğŸ’¡ Tip: For large files, you can use the local version with no file size limit',
                'download-local-link': 'Click to download local version',
                'process-failed-code': 'Processing failed (Error code: {code})',
                'server-error': 'Server returned invalid data format, please retry',
                'upload-rejected-desc': 'File upload rejected, may be due to file size or server restrictions',
                'network-error': 'Network connection failed, please check your network and retry',
                'process-error': 'Processing failed: {error}',
                'process-error-general': 'Error occurred during processing, please retry'
            }
        };
        
        // å½“å‰è¯­è¨€
        let currentLang = localStorage.getItem('language') || 'zh';
        
        // ç¿»è¯‘å‡½æ•°
        function t(key, params = {}) {
            let text = translations[currentLang][key] || translations['zh'][key] || key;
            // æ›¿æ¢å‚æ•°
            Object.keys(params).forEach(param => {
                text = text.replace(`{${param}}`, params[param]);
            });
            return text;
        }
        
        // åˆ‡æ¢è¯­è¨€
        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('language', lang);
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            
            // æ›´æ–°æ‰€æœ‰å¸¦data-i18nçš„å…ƒç´ 
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });
            
            // æ›´æ–°placeholder
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });
        }
        
        // åˆå§‹åŒ–è¯­è¨€
        switchLanguage(currentLang);
        
        // è¯­è¨€åˆ‡æ¢æŒ‰é’®äº‹ä»¶
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                switchLanguage(btn.dataset.lang);
            });
        });
        
        // å½©è›‹ï¼šExpressive/Loud å­—ä½“åˆ—è¡¨ï¼ˆGoogle Fontsï¼‰
        const expressiveFonts = [
            { name: 'Climate Crisis', family: 'Climate Crisis', weight: '400' }, // é»˜è®¤å­—ä½“
            { name: 'Bungee', family: 'Bungee', weight: '400' },
            { name: 'Bungee Shade', family: 'Bungee Shade', weight: '400' },
            { name: 'Creepster', family: 'Creepster', weight: '400' },
            { name: 'Eater', family: 'Eater', weight: '400' },
            { name: 'Flamenco', family: 'Flamenco', weight: '400' },
            { name: 'Fredoka One', family: 'Fredoka One', weight: '400' },
            { name: 'Londrina Outline', family: 'Londrina Outline', weight: '400' },
            { name: 'Londrina Shadow', family: 'Londrina Shadow', weight: '400' },
            { name: 'Londrina Solid', family: 'Londrina Solid', weight: '400' },
            { name: 'Modak', family: 'Modak', weight: '400' },
            { name: 'Monoton', family: 'Monoton', weight: '400' },
            { name: 'Nosifer', family: 'Nosifer', weight: '400' },
            { name: 'Rubik Glitch', family: 'Rubik Glitch', weight: '400' },
            { name: 'Rubik Moonrocks', family: 'Rubik Moonrocks', weight: '400' },
            { name: 'Rubik Wet Paint', family: 'Rubik Wet Paint', weight: '400' },
            { name: 'Sigmar One', family: 'Sigmar One', weight: '400' },
            { name: 'Bungee Inline', family: 'Bungee Inline', weight: '400' },
            { name: 'Fascinate Inline', family: 'Fascinate Inline', weight: '400' },
            { name: 'Faster One', family: 'Faster One', weight: '400' }
        ];
        
        let loadedFonts = new Set(['Climate Crisis']); // å·²åŠ è½½çš„å­—ä½“é›†åˆ
        let currentFontIndex = 0; // å½“å‰å­—ä½“ç´¢å¼•ï¼ˆ0 æ˜¯é»˜è®¤çš„ Climate Crisisï¼‰
        
        // åŠ¨æ€åŠ è½½ Google Fonts
        function loadGoogleFont(fontFamily) {
            if (loadedFonts.has(fontFamily)) {
                return Promise.resolve();
            }
            
            return new Promise((resolve, reject) => {
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = `https://fonts.googleapis.com/css2?family=${encodeURIComponent(fontFamily)}:wght@400&display=swap`;
                link.onload = () => {
                    loadedFonts.add(fontFamily);
                    resolve();
                };
                link.onerror = reject;
                document.head.appendChild(link);
            });
        }
        
        // éšæœºåˆ‡æ¢å­—ä½“
        async function switchRandomFont() {
            const h1 = document.querySelector('.hero h1');
            if (!h1) return;
            
            // éšæœºé€‰æ‹©ä¸€ä¸ªå­—ä½“ï¼ˆæ’é™¤å½“å‰å­—ä½“ï¼‰
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * expressiveFonts.length);
            } while (newIndex === currentFontIndex && expressiveFonts.length > 1);
            
            const selectedFont = expressiveFonts[newIndex];
            currentFontIndex = newIndex;
            
            // åŠ è½½å­—ä½“ï¼ˆå¦‚æœå°šæœªåŠ è½½ï¼‰
            try {
                await loadGoogleFont(selectedFont.family);
                
                // åº”ç”¨æ–°å­—ä½“
                h1.style.fontFamily = `"${selectedFont.family}", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`;
                
                // æ·»åŠ åˆ‡æ¢åŠ¨ç”»æ•ˆæœ
                h1.style.transition = 'all 0.3s ease';
                h1.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    h1.style.transform = 'scale(1)';
                }, 150);
            } catch (error) {
                console.error('åŠ è½½å­—ä½“å¤±è´¥:', error);
            }
        }
        
        // é‡ç½®ä¸ºé»˜è®¤å­—ä½“
        function resetToDefaultFont() {
            const h1 = document.querySelector('.hero h1');
            if (!h1) return;
            currentFontIndex = 0;
            h1.style.fontFamily = '"Climate Crisis", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
        }
        
        // ç‚¹å‡»è®¡æ•°å™¨ï¼ˆç”¨äºçƒŸèŠ±å½©è›‹ï¼‰
        let clickCount = 0;
        const CLICK_THRESHOLD = 10; // è§¦å‘çƒŸèŠ±çš„ç‚¹å‡»æ¬¡æ•°
        
        // çƒŸèŠ±æ•ˆæœå‡½æ•°
        function createFireworks() {
            // åˆ›å»ºå…¨å±€çƒŸèŠ±å®¹å™¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            let container = document.querySelector('.fireworks-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'fireworks-container';
                document.body.appendChild(container);
            }
            
            // æ¸…é™¤ä¹‹å‰çš„çƒŸèŠ±
            container.innerHTML = '';
            
            // åˆ›å»ºå¤šä¸ªçƒŸèŠ±
            const fireworkCount = 30;
            const colors = ['#3043eb', '#4c5df6', '#ff6b6b', '#4ecdc4', '#ffe66d', '#ff6b9d', '#c44569', '#f8b500', '#ff4757', '#5f27cd'];
            
            for (let i = 0; i < fireworkCount; i++) {
                setTimeout(() => {
                    createSingleFirework(container, colors);
                }, i * 30); // é”™å¼€æ—¶é—´ï¼Œå½¢æˆè¿ç»­æ•ˆæœ
            }
            
            // 3ç§’åæ¸…é™¤çƒŸèŠ±å®¹å™¨
            setTimeout(() => {
                if (container) {
                    container.innerHTML = '';
                }
            }, 3000);
        }
        
        // åˆ›å»ºå•ä¸ªçƒŸèŠ±
        function createSingleFirework(container, colors) {
            // åœ¨æ•´ä¸ªè§†çª—èŒƒå›´å†…éšæœºä½ç½®
            const x = Math.random() * window.innerWidth;
            const y = Math.random() * window.innerHeight * 0.7; // ä¸»è¦åœ¨ä¸ŠåŠéƒ¨åˆ†ï¼Œä½†è¦†ç›–æ•´ä¸ªé¡µé¢
            
            // åˆ›å»ºçƒŸèŠ±ä¸­å¿ƒ
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = x + 'px';
            firework.style.top = y + 'px';
            firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            firework.style.boxShadow = `0 0 10px ${firework.style.backgroundColor}`;
            container.appendChild(firework);
            
                // åˆ›å»ºç²’å­æ•ˆæœ
                const particleCount = 16;
                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'firework-particle';
                    particle.style.left = x + 'px';
                    particle.style.top = y + 'px';
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.backgroundColor = color;
                    particle.style.color = color;
                    
                    // è®¡ç®—ç²’å­é£æ•£æ–¹å‘
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const distance = 60 + Math.random() * 80;
                    const tx = Math.cos(angle) * distance;
                    const ty = Math.sin(angle) * distance;
                    
                    particle.style.setProperty('--tx', tx + 'px');
                    particle.style.setProperty('--ty', ty + 'px');
                    
                    container.appendChild(particle);
                }
            
            // ç§»é™¤å…ƒç´ 
            setTimeout(() => {
                if (firework.parentNode) {
                    firework.parentNode.removeChild(firework);
                }
                document.querySelectorAll('.firework-particle').forEach(p => {
                    if (p.parentNode) {
                        p.parentNode.removeChild(p);
                    }
                });
            }, 2000);
        }
        
        // ç‚¹å‡» h1 æ ‡é¢˜çš„å¤„ç†å‡½æ•°
        function handleH1Click() {
            // åˆ‡æ¢å­—ä½“
            switchRandomFont();
            
            // å¢åŠ ç‚¹å‡»è®¡æ•°
            clickCount++;
            
            // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è§¦å‘æ¡ä»¶
            if (clickCount >= CLICK_THRESHOLD) {
                // è§¦å‘çƒŸèŠ±æ•ˆæœ
                createFireworks();
                // é‡ç½®è®¡æ•°å™¨ï¼ˆå¯é€‰ï¼šå¦‚æœæƒ³å†æ¬¡è§¦å‘ï¼Œå¯ä»¥é‡ç½®ä¸º0ï¼‰
                clickCount = 0;
            }
        }
        
        // ç‚¹å‡» h1 æ ‡é¢˜åˆ‡æ¢å­—ä½“å’Œè®¡æ•°
        const heroH1 = document.querySelector('.hero h1');
        if (heroH1) {
            heroH1.addEventListener('click', handleH1Click);
        }
        
        let currentFiles = new Set();
        
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const fileList = document.getElementById('file-list');
        const processBtn = document.getElementById('process-btn');
        const progress = document.getElementById('progress');
        const result = document.getElementById('result');
        const sizeInfo = document.getElementById('size-info');
        const customCharsInput = document.getElementById('customChars');
        
        // è‡ªå®šä¹‰å­—ç¬¦è¾“å…¥æ¡†è‡ªé€‚åº”é«˜åº¦
        function autoResizeCustomChars() {
            if (!customCharsInput) return;
            customCharsInput.style.height = 'auto';
            customCharsInput.style.height = `${customCharsInput.scrollHeight}px`;
        }
        if (customCharsInput) {
            autoResizeCustomChars();
            customCharsInput.addEventListener('input', autoResizeCustomChars);
        }
        
        // æ·»åŠ é”™è¯¯å¤„ç†å‡½æ•°
        function showError(message) {
            const resultPanel = document.querySelector('.result-panel');
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result-item error';
            resultDiv.innerHTML = `
                <span class="filename">${t('error')}</span>
                <span class="status error">${t('process-failed')}</span>
                <span class="error-message">${message}</span>
            `;
            resultPanel.appendChild(resultDiv);
        }
        
        function updateFileList() {
            fileList.innerHTML = '';
            currentFiles.forEach(file => {
                const item = document.createElement('div');
                item.className = 'file-item fade-in';
                
                const name = document.createElement('span');
                name.textContent = file.name;
                
                const removeBtn = document.createElement('span');
                removeBtn.textContent = 'Ã—';
                removeBtn.style.cursor = 'pointer';
                removeBtn.onclick = (e) => {
                    e.stopPropagation();
                    currentFiles.delete(file);
                    updateFileList();
                    processBtn.disabled = currentFiles.size === 0;
                };
                
                item.appendChild(name);
                item.appendChild(removeBtn);
                fileList.appendChild(item);
            });
        }
        
        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.name.match(/\.(ttf|otf|woff|woff2|eot|ttc)$/i)) {
                    // æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡100MB
                    if (file.size > 100 * 1024 * 1024) {
                        // æ˜¾ç¤ºæ–‡ä»¶å¤§å°é”™è¯¯ï¼ŒåŒ…å«ä¸‹è½½æœ¬åœ°ç‰ˆæç¤º
                        const resultPanel = document.querySelector('.result-panel');
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'result-item error';
                        const errorMsg = !IS_LOCAL 
                            ? `${t('file-too-big-suggestion')} <a href="/download/local" style="color: var(--primary); text-decoration: underline; margin-left: 4px;">${t('download-local-link')}</a>`
                            : t('file-too-big-suggestion');
                        resultDiv.innerHTML = `
                            <span class="filename">${file.name}</span>
                            <span class="status error">${t('process-failed')}</span>
                            <span class="error-message">${errorMsg}</span>
                        `;
                        resultPanel.appendChild(resultDiv);
                        return;
                    }
                    currentFiles.add(file);
                }
            });
            updateFileList();
            processBtn.disabled = currentFiles.size === 0;
        }
        
        // å¤„ç†æ‹–æ”¾
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => {
                dropArea.classList.add('dragover');
            });
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, () => {
                dropArea.classList.remove('dragover');
            });
        });
        
        dropArea.addEventListener('drop', (e) => {
            handleFiles(e.dataTransfer.files);
        });
        
        // å¤„ç†ç‚¹å‡»é€‰æ‹©
        dropArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        fileInput.addEventListener('change', function() {
            handleFiles(this.files);
        });
        
        // å¤„ç†æ–‡ä»¶å¤„ç†
        processBtn.addEventListener('click', async () => {
            try {
                progress.style.display = 'block';
                progress.textContent = t('processing');
                processBtn.disabled = true;
                document.querySelector('.result-panel').innerHTML = ''; // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
                
                let processed = 0;
                let progressInterval = null;
                
                // æ”¶é›†æ‰€æœ‰é€‰é¡¹
                const options = {};
                
                // è·å–æ‰€æœ‰å¤é€‰æ¡†çš„çŠ¶æ€
                document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                    options[checkbox.name] = checkbox.checked;
                });
                
                // æ·»åŠ è‡ªå®šä¹‰å­—ç¬¦
                const customChars = document.getElementById('customChars').value;
                if (customChars) {
                    options.customChars = customChars;
                }
                
                console.log('é€‰é¡¹çŠ¶æ€:', options);
                
                // å°†æ–‡ä»¶é›†åˆè½¬æ¢ä¸ºæ•°ç»„ä»¥ä¾¿ç´¢å¼•è®¿é—®
                const filesArray = Array.from(currentFiles);
                
                // é¢„åŠ è½½é˜Ÿåˆ—ï¼šå­˜å‚¨æå‰å‘èµ·çš„è¯·æ±‚
                const preloadQueue = new Map();
                
                // é¢„åŠ è½½ä¸‹ä¸€ä¸ªæ–‡ä»¶
                const preloadNextFile = (nextIndex) => {
                    if (nextIndex >= filesArray.length) return null;
                    
                    const nextFile = filesArray[nextIndex];
                    const formData = new FormData();
                    formData.append('font', nextFile);
                    formData.append('options', JSON.stringify(options));
                    
                    console.log('é¢„åŠ è½½æ–‡ä»¶:', nextFile.name);
                    
                    // æå‰å‘èµ·è¯·æ±‚ï¼Œä½†ä¸ç­‰å¾…å“åº”
                    const preloadPromise = fetch('/process', {
                        method: 'POST',
                        body: formData
                    }).then(response => {
                        // è¯»å–å“åº”ä½†ä¸è§£æï¼Œç­‰å¾…å®é™…å¤„ç†æ—¶å†è§£æ
                        return response.text().then(text => ({ response, text }));
                    });
                    
                    preloadQueue.set(nextIndex, preloadPromise);
                    return preloadPromise;
                };
                
                // å¤„ç†å•ä¸ªæ–‡ä»¶çš„å‡½æ•°
                const processFile = async (fileIndex, file) => {
                    // æ£€æŸ¥æ˜¯å¦æœ‰é¢„åŠ è½½çš„è¯·æ±‚
                    let responsePromise = preloadQueue.get(fileIndex);
                    
                    if (!responsePromise) {
                        // å¦‚æœæ²¡æœ‰é¢„åŠ è½½ï¼Œæ­£å¸¸å‘èµ·è¯·æ±‚
                        const formData = new FormData();
                        formData.append('font', file);
                        formData.append('options', JSON.stringify(options));
                        
                        console.log('å¼€å§‹å¤„ç†æ–‡ä»¶:', file.name);
                        console.log('æ–‡ä»¶å¤§å°:', file.size);
                        
                        responsePromise = fetch('/process', {
                            method: 'POST',
                            body: formData
                        }).then(response => {
                            return response.text().then(text => ({ response, text }));
                        });
                    } else {
                        // ä½¿ç”¨é¢„åŠ è½½çš„è¯·æ±‚
                        console.log('ä½¿ç”¨é¢„åŠ è½½çš„æ–‡ä»¶:', file.name);
                        preloadQueue.delete(fileIndex);
                    }
                    
                    // å¯åŠ¨æ¨¡æ‹Ÿè¿›åº¦
                    startSimulatedProgress(processed, filesArray.length);
                    
                    // æå‰é¢„åŠ è½½ä¸‹ä¸€ä¸ªæ–‡ä»¶
                    if (fileIndex + 1 < filesArray.length) {
                        preloadNextFile(fileIndex + 1);
                    }
                    
                    const { response, text: rawText } = await responsePromise;
                    
                    // åœæ­¢æ¨¡æ‹Ÿè¿›åº¦
                    if (progressInterval) {
                        clearTimeout(progressInterval);
                        progressInterval = null;
                    }
                    
                    return { response, rawText };
                };
                
                // æ›´æ–°è¿›åº¦çš„å‡½æ•°
                const updateProgress = (current, total) => {
                    const baseProgress = Math.round((current / total) * 100);
                    progress.textContent = `${t('processing')} ${baseProgress}%`;
                };
                
                // å¯åŠ¨æ¨¡æ‹Ÿè¿›åº¦ï¼ˆç”¨äºå•ä¸ªæ–‡ä»¶å¤„ç†æ—¶æ˜¾ç¤ºè¿›åº¦ï¼‰
                const startSimulatedProgress = (fileIndex, totalFiles) => {
                    if (progressInterval) {
                        clearTimeout(progressInterval);
                    }
                    
                    const baseProgress = (fileIndex / totalFiles) * 100;
                    const maxProgress = ((fileIndex + 1) / totalFiles) * 100 - 5; // ç•™5%ç»™å®Œæˆæ—¶
                    
                    // å¯¹äºå•ä¸ªæ–‡ä»¶ï¼Œä»10%å¼€å§‹ï¼Œé¿å…ä¸€ç›´æ˜¾ç¤º0%
                    const startProgress = totalFiles === 1 ? 10 : baseProgress;
                    let currentSimulated = startProgress - baseProgress;
                    
                    // ç«‹å³æ˜¾ç¤ºåˆå§‹è¿›åº¦
                    progress.textContent = `${t('processing')} ${Math.round(startProgress)}%`;
                    
                    const updateProgress = () => {
                        // éšæœºå¢åŠ è¿›åº¦ï¼š1-5%ä¹‹é—´ï¼Œä½†è¶Šæ¥è¿‘maxProgressï¼Œå¢åŠ è¶Šæ…¢
                        const remaining = maxProgress - (baseProgress + currentSimulated);
                        let increment;
                        
                        if (remaining > 20) {
                            // è¿˜æœ‰è¾ƒå¤šå‰©ä½™ï¼Œå¯ä»¥å¿«é€Ÿå¢åŠ 
                            increment = 1 + Math.random() * 4; // 1-5%
                        } else if (remaining > 10) {
                            // ä¸­ç­‰å‰©ä½™ï¼Œä¸­ç­‰é€Ÿåº¦
                            increment = 0.5 + Math.random() * 2.5; // 0.5-3%
                        } else {
                            // æ¥è¿‘å®Œæˆï¼Œæ…¢é€Ÿå¢åŠ 
                            increment = 0.3 + Math.random() * 1.2; // 0.3-1.5%
                        }
                        
                        currentSimulated += increment;
                        const simulatedProgress = Math.min(baseProgress + currentSimulated, maxProgress);
                        progress.textContent = `${t('processing')} ${Math.round(simulatedProgress)}%`;
                        
                        // å¦‚æœè¿˜æ²¡è¾¾åˆ°æœ€å¤§å€¼ï¼Œç»§ç»­æ›´æ–°ï¼ˆä½¿ç”¨éšæœºé—´éš”ï¼‰
                        if (simulatedProgress < maxProgress) {
                            const nextInterval = totalFiles === 1 
                                ? 80 + Math.random() * 120  // 80-200ms
                                : 100 + Math.random() * 150; // 100-250ms
                            progressInterval = setTimeout(updateProgress, nextInterval);
                        } else {
                            progressInterval = null;
                        }
                    };
                    
                    // å¯åŠ¨ç¬¬ä¸€æ¬¡æ›´æ–°ï¼ˆä½¿ç”¨éšæœºåˆå§‹å»¶è¿Ÿï¼‰
                    const initialDelay = totalFiles === 1 
                        ? 100 + Math.random() * 100  // 100-200ms
                        : 150 + Math.random() * 100; // 150-250ms
                    progressInterval = setTimeout(updateProgress, initialDelay);
                };
                
                // é¢„åŠ è½½ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶ï¼‰
                if (filesArray.length > 1) {
                    preloadNextFile(0);
                }
                
                // é¡ºåºå¤„ç†æ‰€æœ‰æ–‡ä»¶
                for (let i = 0; i < filesArray.length; i++) {
                    const file = filesArray[i];
                    
                    try {
                        // ä½¿ç”¨ç»Ÿä¸€çš„å¤„ç†å‡½æ•°
                        const { response, rawText } = await processFile(i, file);
                        let parsed;
                        try {
                            parsed = rawText ? JSON.parse(rawText) : null;
                        } catch (_) {
                            parsed = null;
                        }
                        
                        if (!response.ok) {
                            const isForbidden = response.status === 403 || (rawText && rawText.includes('Forbidden'));
                            let baseMsg = (parsed && (parsed.error || parsed.message)) 
                                || rawText 
                                || t('process-failed-code', { code: response.status });
                            
                            // æ£€æŸ¥æ˜¯å¦å»ºè®®ä¸‹è½½æœ¬åœ°ç‰ˆ
                            const suggestDownloadLocal = parsed && parsed.suggest_download_local;
                            const downloadLocalUrl = parsed && parsed.download_local_url || '/download/local';
                            
                            // æ ¹æ®çŠ¶æ€ç è®¾ç½®é”™è¯¯æ¶ˆæ¯
                            if (isForbidden) {
                                baseMsg = t('upload-rejected');
                            } else if (response.status === 429) {
                                baseMsg = t('too-many-requests');
                            } else if (response.status === 413 || response.status === 400) {
                                // æ£€æŸ¥æ˜¯å¦æ˜¯æ–‡ä»¶å¤§å°é”™è¯¯
                                const isFileSizeError = baseMsg && (
                                    baseMsg.includes('100MB') || 
                                    baseMsg.includes('100mb') || 
                                    baseMsg.includes('æ–‡ä»¶å¤ªå¤§') || 
                                    baseMsg.includes('æ–‡ä»¶è¶…è¿‡') ||
                                    suggestDownloadLocal
                                );
                                if (isFileSizeError) {
                                    baseMsg = t('file-too-big-suggestion');
                                } else {
                                    baseMsg = t('file-too-big');
                                }
                            } else if (!baseMsg || baseMsg.length < 50) {
                                baseMsg = t('process-failed-code', { code: response.status });
                            }
                            
                            // åˆ›å»ºé”™è¯¯å¯¹è±¡ï¼ŒåŒ…å«ä¸‹è½½æœ¬åœ°ç‰ˆä¿¡æ¯
                            const error = new Error(baseMsg);
                            if (suggestDownloadLocal || (response.status === 413 || (response.status === 400 && baseMsg.includes('100MB')))) {
                                error.suggestDownloadLocal = true;
                                error.downloadLocalUrl = downloadLocalUrl;
                            }
                            
                            throw error;
                        }
                        
                        if (!parsed || typeof parsed !== 'object') {
                            throw new Error(t('server-error'));
                        }
                        const data = parsed;
                        console.log('å¤„ç†ç»“æœ:', data);
                        
                        // æ˜¾ç¤ºå¤„ç†ç»“æœ
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'result-item';
                        resultDiv.innerHTML = `
                            <div class="file-result fade-in">
                                <div class="file-info">
                                    <div class="file-name">${file.name}</div>
                                    <div class="file-stats">
                                        <div class="stat-item">
                                            <span class="stat-label">${t('original')}</span>
                                            <span class="stat-value">${data.original_size}</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">${t('optimized')}</span>
                                            <span class="stat-value">${data.new_size}</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="reduction">-${data.reduction}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        document.querySelector('.result-panel').appendChild(resultDiv);
                        
                        // è‡ªåŠ¨è§¦å‘ä¸‹è½½
                        if (data.download_url) {
                            const link = document.createElement('a');
                            link.href = data.download_url;
                            link.download = file.name;  // ä½¿ç”¨åŸå§‹æ–‡ä»¶å
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                        }
                        
                    } catch (error) {
                        console.error('å¤„ç†æ–‡ä»¶æ—¶å‡ºé”™:', error);
                        // å¤„ç†é”™è¯¯æ¶ˆæ¯
                        let errorMsg = error.message || t('process-failed');
                        const errorLower = errorMsg.toLowerCase();
                        let suggestDownloadLocal = error.suggestDownloadLocal || false;
                        let downloadLocalUrl = error.downloadLocalUrl || '/download/local';
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯æ–‡ä»¶å¤§å°ç›¸å…³é”™è¯¯
                        const isFileSizeError = errorLower.includes('100mb') || 
                                               errorLower.includes('100 mb') || 
                                               errorLower.includes('æ–‡ä»¶å¤ªå¤§') || 
                                               errorLower.includes('æ–‡ä»¶è¶…è¿‡') ||
                                               errorLower.includes('file too large') ||
                                               errorLower.includes('exceeds 100mb') ||
                                               suggestDownloadLocal;
                        
                        if (errorLower.includes('too many requests') || errorLower.includes('429')) {
                            errorMsg = t('too-many-requests');
                        } else if (errorLower.includes('forbidden') || errorLower.includes('403')) {
                            errorMsg = t('upload-rejected-desc');
                        } else if (errorLower.includes('network') || errorLower.includes('fetch')) {
                            errorMsg = t('network-error');
                        } else if (isFileSizeError) {
                            errorMsg = t('file-too-big-suggestion');
                            suggestDownloadLocal = true;
                        } else if (!errorMsg || errorMsg === 'å¤„ç†å¤±è´¥') {
                            errorMsg = t('process-error', { error: errorMsg });
                        }
                        
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'result-item error';
                        
                        // å¦‚æœå»ºè®®ä¸‹è½½æœ¬åœ°ç‰ˆï¼Œåœ¨é”™è¯¯æ¶ˆæ¯ä¸­æ·»åŠ ä¸‹è½½é“¾æ¥
                        if (suggestDownloadLocal && !IS_LOCAL) {
                            errorMsg = `${errorMsg} <a href="${downloadLocalUrl}" style="color: var(--primary); text-decoration: underline; margin-left: 4px;">${t('download-local-link')}</a>`;
                        }
                        
                        let errorHtml = `
                            <span class="filename">${file.name}</span>
                            <span class="status error">${t('process-failed')}</span>
                            <span class="error-message">${errorMsg}</span>
                        `;
                        
                        resultDiv.innerHTML = errorHtml;
                        document.querySelector('.result-panel').appendChild(resultDiv);
                    }
                    
                    processed++;
                    // æ›´æ–°çœŸå®è¿›åº¦
                    updateProgress(processed, filesArray.length);
                }
                
                // æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆï¼Œæ˜¾ç¤º100%
                if (progressInterval) {
                    clearTimeout(progressInterval);
                    progressInterval = null;
                }
                progress.textContent = `${t('processing')} 100%`;
                
            } catch (error) {
                console.error('æ•´ä½“å¤„ç†è¿‡ç¨‹å‡ºé”™:', error);
                if (progressInterval) {
                    clearTimeout(progressInterval);
                    progressInterval = null;
                }
                let errorMsg = error.message || t('process-error-general');
                if (!errorMsg || errorMsg.length < 10) {
                    errorMsg = t('process-error-general');
                }
                showError(errorMsg);
            } finally {
                // å»¶è¿Ÿä¸€ç‚¹å†éšè—ï¼Œè®©ç”¨æˆ·çœ‹åˆ°100%
                setTimeout(() => {
                    progress.style.display = 'none';
                }, 300);
                processBtn.disabled = false;
            }
        });
    </script>
</body>
</html> 